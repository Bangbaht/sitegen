#!/usr/bin/env node

import program              from 'commander';
import path                 from 'path';
import Webpack              from 'webpack';
import pkg                  from '../../package.json';
import configureFromDirectory from '../configureFromDirectory';

program
  .version(pkg.version)
  .usage('sitegen-build [options] <site>')
  .description('Serve site')
  .option('-L, --lib <directory>', 'site library directory')
  .option('-o, --output <directory>', 'output directory')
  .parse(process.argv);

let cwd = process.cwd();
let site = path.join(cwd, program.args[0] || '.');

let renderAssets = Webpack(configureFromDirectory(site, {
  lib: program.lib,
  output: program.output,
  mode: 'serve',
  compilerName: 'sitegen-assets',
}));

let renderPages = Webpack(configureFromDirectory(site, {
  lib: program.lib,
  output: program.output,
  mode: 'build',
  compilerName: 'sitegen-pages',
}));

renderAssets.run(function(error) {
  if (error) {
    throw error;
  }
});

renderPages.run(function(error) {
  if (error) {
    throw error;
  }
});
